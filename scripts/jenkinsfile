pipeline {

    agent { label 'android' }

    environment {
        ANDROID_HOME = "/Users/mobile/Library/Android/sdk"
        ANDROID_SERIAL = "emulator-5554"
    }

    stages {
        stage('Checkout Repo') {
            steps {
                checkout scm
            }
        }
        stage('Reset Devices, download Composer') {
            steps {
                sh 'scripts/jenkins.sh init'
            }
        }
        stage('Build Debug and Test App, copy to root dir') {
            steps {
                sh 'scripts/jenkins.sh build'
            }
        }
        stage('Run Tests') {
            steps {
                sh 'scripts/jenkins.sh run com.zendesk.connect.testapp'
            }
        }
    }
}
